class Calendar{constructor(e,t=null,a=[],n=[]){this.containerID=e,this.today=null==t?new Date:t,this.events=a,this.days=0==n.length?["Po","Út","St","Čt","Pá","So","Ne"]:n;for(let e=0;e<this.events.length;e++)this.events[e].date=new Date(this.events[e].date);this.displayedDates=[],this.eventCallback=null}normalizeDate(e){const t=e.getDate(),a=e.getMonth(),n=e.getFullYear();return`${n}-${a}-${t}`}addEvent(e,t,a=!1){if(this.events.push({name:e,date:new Date(t)}),a){const e=document.getElementById("date-picker").value;this.redrawCalendar(),document.getElementById("date-picker").value=e}}createNavigationBar(){const e=document.createElement("div");e.classList.add("navigation-bar");const t=document.createElement("button");t.id="btn-prev",t.innerHTML="&larr;";const a=document.createElement("input");a.id="date-picker",a.type="date";const n=document.createElement("button");return n.id="btn-next",n.innerHTML="&rarr;",e.appendChild(t),e.appendChild(a),e.appendChild(n),e}render(e=!1){this.redrawCalendar(),document.getElementById("date-picker").value=this.today.toISOString().split("T")[0],e&&this.executeCallback()}redrawCalendar(){const e=document.getElementById(this.containerID);if(!e)throw ReferenceError(`Element with ID: ${this.containerID} not found`);this.displayedDates=[],e.innerHTML="",e.appendChild(this.createNavigationBar());const t=this.getDaysInMonth(this.today.getFullYear(),this.today.getMonth()),a=new Date(t[0]);let n=document.createElement("div");n.classList.add("calendar-container");let s=null;for(let e=0;e<this.days.length;e++)s=document.createElement("div"),s.classList.add("calendar-cell"),s.classList.add("header"),s.innerText=this.days[e],n.appendChild(s);let d=this.getDaysInPrevMonth(this.today),i=null;for(let e=d.length-(0==a.getDay()?6:a.getDay()-1);e<d.length;e++){s=document.createElement("div"),s.classList.add("calendar-cell-other-month");const t=this.events.filter(t=>this.normalizeDate(d[e])==this.normalizeDate(new Date(t.date)));if(t.length>0){const e=document.createElement("div");e.classList.add("event"),i=new Date(t[0].date),e.innerText=i.getDate(),this.displayedDates.push(i),e.title=this.getTitle(t),s.appendChild(e)}else i=new Date(d[e]),s.innerText=i.getDate(),this.displayedDates.push(i);n.appendChild(s)}for(let e=0;e<t.length;e++){s=document.createElement("div"),s.classList.add("calendar-cell"),this.today.getDate()-1==e&&s.classList.add("cell-today");const a=this.events.filter(a=>this.normalizeDate(t[e])==this.normalizeDate(new Date(a.date)));if(a.length>0){const e=document.createElement("div");e.classList.add("event"),i=new Date(a[0].date),e.innerText=i.getDate(),this.displayedDates.push(i),e.title=this.getTitle(a),s.appendChild(e)}else i=new Date(t[e]),s.innerText=i.getDate(),this.displayedDates.push(i);n.appendChild(s)}let l=this.getDaysInNextMonth(this.today);const r=49-n.childElementCount;for(let e=0;e<r;e++){s=document.createElement("div"),s.classList.add("calendar-cell-other-month");const t=this.events.filter(t=>this.normalizeDate(new Date(l[e]))==this.normalizeDate(new Date(t.date)));if(t.length>0){const e=document.createElement("div");e.classList.add("event"),i=new Date(t[0].date),e.innerText=i.getDate(),this.displayedDates.push(i),e.title=this.getTitle(t),s.appendChild(e)}else i=new Date(l[e]),s.innerText=i.getDate(),this.displayedDates.push(i);n.appendChild(s)}e.appendChild(n),this.appendCalendarEvents()}getTitle(e){return e.map(e=>e.name).join(",")}appendCalendarEvents(){const e=document.getElementById("btn-next");e.addEventListener("click",()=>{const e=this.today.getMonth(),t=this.today.getFullYear();11==e?(this.today.setMonth(0),this.today.setFullYear(t+1)):this.today.setMonth(e+1),this.redrawCalendar(),document.getElementById("date-picker").value=this.today.toISOString().split("T")[0],this.executeCallback()});const t=document.getElementById("btn-prev");t.addEventListener("click",()=>{const e=this.today.getMonth(),t=this.today.getFullYear();0==e?(this.today.setMonth(11),this.today.setFullYear(t-1)):this.today.setMonth(e-1),this.redrawCalendar(),document.getElementById("date-picker").value=this.today.toISOString().split("T")[0],this.executeCallback()});const a=document.getElementById("date-picker");a.addEventListener("blur",e=>{this.today=new Date(document.getElementById("date-picker").value),this.redrawCalendar(),document.getElementById("date-picker").value=this.today.toISOString().split("T")[0],this.executeCallback()})}setEventCallback(e){this.eventCallback=e}executeCallback(){this.eventCallback&&this.eventCallback(this.displayedDates)}getDaysInPrevMonth(e){let t=e.getFullYear(),a=e.getMonth();return 0==a?(a=11,t-=1):a-=1,this.getDaysInMonth(t,a)}getDaysInNextMonth(e){let t=e.getFullYear(),a=e.getMonth();return 11==a?(a=0,t+=1):a+=1,this.getDaysInMonth(t,a)}getDaysInMonth(e,t){const a=[],n=new Date(e,t,1);for(;n.getMonth()===t;)a.push(new Date(n)),n.setDate(n.getDate()+1);return a}}